count_superstate_members = {

	#Determine members
	set_variable = { 
		name = superstate_members
		value = 0
	}
	if = {
		limit = {
			OR = {
				has_variable = superstate_free_trade_zone
				has_variable = superstate_customs_union
				has_variable = superstate_defence_union
				has_variable = superstate_political_union
			}
		}
		change_variable = { 
			name = superstate_members
			add = 1
		}
		every_country = {
			limit = { 
				shares_same_superstate = yes
				OR = {
					has_variable = superstate_free_trade_zone
					has_variable = superstate_customs_union
					has_variable = superstate_defence_union
					has_variable = superstate_political_union
				}
			}
			ROOT = {
				change_variable = { 
					name = superstate_members
					add = 1
				}
			}
		}
	}
	else = {
		change_variable = { 
			name = superstate_members
			add = 1
		}
		every_country = {
			limit = { 
				shares_same_superstate = yes
			}
			ROOT = {
				change_variable = { 
					name = superstate_members
					add = 1
				}
			}
		}
	}
	
	#Determine majority
	set_variable = { 
		name = superstate_members_majority
		value = root.var:superstate_members
	}
	change_variable = {
		name = superstate_members_majority
		divide = 2
	}

}

create_superstate_free_trade_zone = {

	every_country = {
		limit = { 
			shares_same_superstate = yes
			has_variable = superstate_free_trade_zone
			NOR = {
				has_diplomatic_pact = { who = ROOT type = trade_agreement }
				is_junior_in_customs_union = yes
			}
		}
		create_diplomatic_pact = {
			country = ROOT
			type = trade_agreement
		}
		change_relations = { 
			country = ROOT
			value = 25
		}
	}

}

create_superstate_customs_union = {

	#Break customs unions with non-superstate members
	if = {
		limit = { 
			has_variable = superstate_customs_union
			is_junior_in_customs_union = yes
			any_country = {
				leads_customs_union = yes
				NOT = { shares_same_superstate = yes }
				NOT = { has_variable = superstate_customs_union }
			}
		}
		every_country = { 
			limit = { 
				leads_customs_union = yes
				NOT = { shares_same_superstate = yes }
				NOT = { has_variable = superstate_customs_union }
				has_diplomatic_pact = { who = ROOT type = customs_union }
			}
			remove_diplomatic_pact = {
				country = ROOT
				type = customs_union
			}
		}
	}

	#Enter into Customs Union with others
	if = {
		limit = {
			has_variable = superstate_customs_union
			is_junior_in_customs_union = no
			any_country = {
				shares_same_superstate = yes
				is_junior_in_customs_union = no
				has_variable = superstate_customs_union
				this.gdp > root.gdp
			}
		}
		every_country = { 
			limit = { 
				NOT = { shares_same_superstate = yes }
				leads_customs_union = yes
				has_diplomatic_pact = { who = ROOT type = customs_union }
			}
			remove_diplomatic_pact = {
				country = ROOT
				type = customs_union
			}
		}
		random_country = {
			limit = { 
				shares_same_superstate = yes
				is_junior_in_customs_union = no
				has_variable = superstate_customs_union
				this.gdp > root.gdp
			}
			create_diplomatic_pact = {
				country = ROOT
				type = customs_union
			}
			change_relations = { 
				country = ROOT
				value = 25
			}
		}
	}
	else_if = {
		limit = {
			has_variable = superstate_customs_union
			is_junior_in_customs_union = no
			any_country = {
				shares_same_superstate = yes
				is_junior_in_customs_union = no
				has_variable = superstate_customs_union
				this.gdp < root.gdp
			}
		}
		every_country = { 
			limit = { 
				NOT = { shares_same_superstate = yes }
				leads_customs_union = yes
				has_diplomatic_pact = { who = ROOT type = customs_union }
			}
			remove_diplomatic_pact = {
				country = ROOT
				type = customs_union
			}
		}
		random_country = {
			limit = { 
				shares_same_superstate = yes
				is_junior_in_customs_union = no
				has_variable = superstate_customs_union
				this.gdp < root.gdp
			}
			ROOT = {
				create_diplomatic_pact = {
					country = THIS
					type = customs_union
				}
			}
			change_relations = { 
				country = ROOT
				value = 25
			}
		}
	}

}

create_superstate_currency_union = {

	#Enter into Currency Union with others
	every_country = { 
		limit = { 
			OR = { 
				NOT = { shares_same_superstate = yes }
				leads_customs_union = no
			} 
		}
		remove_diplomatic_pact = {
			country = ROOT
			type = currency_union
		}
	}
	random_country = {
		limit = { 
			shares_same_superstate = yes
			leads_customs_union = yes
			has_variable = superstate_currency_union
			NOT = { has_diplomatic_pact = { who = ROOT type = currency_union } }
		}
		create_diplomatic_pact = {
			country = ROOT
			type = currency_union
		}
		change_relations = { 
			country = ROOT
			value = 25
		}
	}

}

create_superstate_defence_union = {

	every_country = {
		limit = { 
			shares_same_superstate = yes
			has_variable = superstate_defence_union
			NOR = {
				has_diplomatic_pact = { who = ROOT type = defensive_pact }
				has_diplomatic_pact = { who = ROOT type = alliance }
			}
		}
		create_diplomatic_pact = {
			country = ROOT
			type = defensive_pact
		}
		change_relations = { 
			country = ROOT
			value = 25
		}
	}

}

create_superstate_confederation = {

	#Confederate THIS with Superstate
	if = {
		limit = { is_subject = yes }
		make_independent = yes
	}
	every_country = {
		limit = {
			NOT = { THIS = ROOT }
			shares_same_superstate = yes
			is_a_superstate_country_tag = yes
		}
		ROOT = { 
			every_country = {
				limit = { 
					has_diplomatic_pact = {
						country = ROOT
						type = currency_union
						is_initiator = yes
					}
				}
				remove_diplomatic_pact = {
					country = ROOT
					type = currency_union
				}
			}
			every_country = {
				limit = { 
					has_diplomatic_pact = {
						country = ROOT
						type = legal_union
						is_initiator = yes
					}
				}
				remove_diplomatic_pact = {
					country = ROOT
					type = legal_union
				}
			}
			every_country = {
				limit = { 
					has_diplomatic_pact = {
						country = ROOT
						type = customs_union
					}
				}
				remove_diplomatic_pact = {
					country = ROOT
					type = customs_union
				}
			}
		}
		create_diplomatic_pact = {
			country = ROOT
			type = confederal_state
		}
		create_diplomatic_pact = {
			country = ROOT
			type = currency_union
		}
		create_diplomatic_pact = {
			country = ROOT
			type = legal_union
		}
		create_diplomatic_pact = {
			country = ROOT
			type = customs_union
		}
	}

}

create_superstate_final_union = {

	#THIS becomes Superstate
	if = { limit = { has_variable = XNA_ambitions } change_tag = XNA }
	if = { limit = { has_variable = XCA_ambitions } change_tag = XCA }
	if = { limit = { has_variable = XSA_ambitions } change_tag = XSA }
	if = { limit = { has_variable = XEU_ambitions } change_tag = XEU }
	if = { limit = { has_variable = XER_ambitions } change_tag = XER }
	if = { limit = { has_variable = XAL_ambitions } change_tag = XAL }
	if = { limit = { has_variable = XAU_ambitions } change_tag = XAU }
	if = { limit = { has_variable = XEA_ambitions } change_tag = XEA }
	if = { limit = { has_variable = XSE_ambitions } change_tag = XSE }
	if = { limit = { has_variable = XPI_ambitions } change_tag = XPI }
	
	#Multiculturalism
	activate_law = law_type:law_multicultural

}

join_superstate_final_union = {

	#THIS joins Superstate
	if = { limit = { exists = c:XNA has_variable = XNA_ambitions } c:XNA = { THIS_joins_superstate_annex = yes } }
	if = { limit = { exists = c:XCA has_variable = XCA_ambitions } c:XCA = { THIS_joins_superstate_annex = yes } }
	if = { limit = { exists = c:XSA has_variable = XSA_ambitions } c:XSA = { THIS_joins_superstate_annex = yes } }
	if = { limit = { exists = c:XEU has_variable = XEU_ambitions } c:XEU = { THIS_joins_superstate_annex = yes } }
	if = { limit = { exists = c:XER has_variable = XER_ambitions } c:XER = { THIS_joins_superstate_annex = yes } }
	if = { limit = { exists = c:XAL has_variable = XAL_ambitions } c:XAL = { THIS_joins_superstate_annex = yes } }
	if = { limit = { exists = c:XAU has_variable = XAU_ambitions } c:XAU = { THIS_joins_superstate_annex = yes } }
	if = { limit = { exists = c:XEA has_variable = XEA_ambitions } c:XEA = { THIS_joins_superstate_annex = yes } }
	if = { limit = { exists = c:XSE has_variable = XSE_ambitions } c:XSE = { THIS_joins_superstate_annex = yes } }
	if = { limit = { exists = c:XPI has_variable = XPI_ambitions } c:XPI = { THIS_joins_superstate_annex = yes } }

}

THIS_joins_superstate_annex = {

	save_scope_as = superstate_country_tag
	
	custom_tooltip = {
		text = superstate_add_primary_culture.tt
		ROOT = { random_primary_culture = { limit = { is_primary_culture_of = ROOT NOT = { is_primary_culture_of = scope:superstate_country_tag } } save_scope_as = culture_to_add } } scope:superstate_country_tag = { add_primary_culture = scope:culture_to_add }
		ROOT = { random_primary_culture = { limit = { is_primary_culture_of = ROOT NOT = { is_primary_culture_of = scope:superstate_country_tag } } save_scope_as = culture_to_add } } scope:superstate_country_tag = { add_primary_culture = scope:culture_to_add }
		ROOT = { random_primary_culture = { limit = { is_primary_culture_of = ROOT NOT = { is_primary_culture_of = scope:superstate_country_tag } } save_scope_as = culture_to_add } } scope:superstate_country_tag = { add_primary_culture = scope:culture_to_add }
		ROOT = { random_primary_culture = { limit = { is_primary_culture_of = ROOT NOT = { is_primary_culture_of = scope:superstate_country_tag } } save_scope_as = culture_to_add } } scope:superstate_country_tag = { add_primary_culture = scope:culture_to_add }
		ROOT = { random_primary_culture = { limit = { is_primary_culture_of = ROOT NOT = { is_primary_culture_of = scope:superstate_country_tag } } save_scope_as = culture_to_add } } scope:superstate_country_tag = { add_primary_culture = scope:culture_to_add }
		ROOT = { random_primary_culture = { limit = { is_primary_culture_of = ROOT NOT = { is_primary_culture_of = scope:superstate_country_tag } } save_scope_as = culture_to_add } } scope:superstate_country_tag = { add_primary_culture = scope:culture_to_add }
		ROOT = { random_primary_culture = { limit = { is_primary_culture_of = ROOT NOT = { is_primary_culture_of = scope:superstate_country_tag } } save_scope_as = culture_to_add } } scope:superstate_country_tag = { add_primary_culture = scope:culture_to_add }
		ROOT = { random_primary_culture = { limit = { is_primary_culture_of = ROOT NOT = { is_primary_culture_of = scope:superstate_country_tag } } save_scope_as = culture_to_add } } scope:superstate_country_tag = { add_primary_culture = scope:culture_to_add }
		ROOT = { random_primary_culture = { limit = { is_primary_culture_of = ROOT NOT = { is_primary_culture_of = scope:superstate_country_tag } } save_scope_as = culture_to_add } } scope:superstate_country_tag = { add_primary_culture = scope:culture_to_add }
		ROOT = { random_primary_culture = { limit = { is_primary_culture_of = ROOT NOT = { is_primary_culture_of = scope:superstate_country_tag } } save_scope_as = culture_to_add } } scope:superstate_country_tag = { add_primary_culture = scope:culture_to_add }
		ROOT = { random_primary_culture = { limit = { is_primary_culture_of = ROOT NOT = { is_primary_culture_of = scope:superstate_country_tag } } save_scope_as = culture_to_add } } scope:superstate_country_tag = { add_primary_culture = scope:culture_to_add }
	}

	annex = ROOT

}